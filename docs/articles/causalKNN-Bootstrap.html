<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>causalKNN Bootstrap Vignette • causalKNN</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="causalKNN Bootstrap Vignette">
<meta property="og:description" content="causalKNN">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">causalKNN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/causalKNN-Intro.html">causalKNN Introduction Vignette</a>
    </li>
    <li>
      <a href="../articles/causalKNN-Bootstrap.html">causalKNN Bootstrap Vignette</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/walterwzhang/causalKNN/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>causalKNN Bootstrap Vignette</h1>
                        <h4 data-toc-skip class="author">Walter
Zhang</h4>
            
            <h4 data-toc-skip class="date">September 18, 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/walterwzhang/causalKNN/blob/HEAD/vignettes/causalKNN-Bootstrap.Rmd" class="external-link"><code>vignettes/causalKNN-Bootstrap.Rmd</code></a></small>
      <div class="hidden name"><code>causalKNN-Bootstrap.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we show how to utilize the bootstrap options in the
<code>causalKNN</code> package get a bagged estimate of our conditional
average treatment effect (CATE). This vignette extends the introductory
vignette.</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>With the causal KNN, we can first bootstrap the procedure where we
search for the optimal K and then the treatment effect estimation
procedure. We will use the following simulated data set for our
procedure.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234L</span><span class="op">)</span></span>
<span><span class="va">n</span>     <span class="op">&lt;-</span>   <span class="fl">5000</span>  <span class="co"># Number of Observations in training set</span></span>
<span><span class="va">p</span>     <span class="op">&lt;-</span>   <span class="fl">21</span>    <span class="co"># Number of Features</span></span>
<span><span class="va">key</span>   <span class="op">&lt;-</span>   <span class="fl">1</span><span class="op">:</span><span class="va">n</span>   <span class="co"># Individual indices</span></span>
<span></span>
<span><span class="va">bootstrap_iterations</span>   <span class="op">&lt;-</span>   <span class="fl">5L</span>  <span class="co"># Number of bootstrap iterations</span></span>
<span></span>
<span><span class="va">n_test</span>     <span class="op">&lt;-</span>   <span class="fl">501</span>  <span class="co"># Number of Observations in test set</span></span>
<span><span class="va">key_test</span>   <span class="op">&lt;-</span>   <span class="fl">1</span><span class="op">:</span><span class="va">n_test</span></span>
<span></span>
<span><span class="va">X</span>     <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">*</span><span class="va">n</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">*</span><span class="va">n</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">*</span><span class="va">n</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_test</span>           <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_test</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">X_test</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>       <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span><span class="op">)</span></span>
<span><span class="va">X_test</span><span class="op">[</span>,<span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>   <span class="op">&lt;-</span>   <span class="fl">5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">TE</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="va">p</span><span class="op">/</span><span class="fl">3</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">W</span>    <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">Y</span>    <span class="op">&lt;-</span>   <span class="va">TE</span> <span class="op">*</span> <span class="va">W</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">X</span><span class="op">[</span>,<span class="fl">8</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k</span>                 <span class="op">&lt;-</span>   <span class="fl">160L</span>         <span class="co"># Number of NN to search</span></span>
<span><span class="va">distance_metric</span>   <span class="op">&lt;-</span>   <span class="st">"euclidean"</span>  <span class="co"># Distance metric</span></span>
<span><span class="va">keep_dist</span>         <span class="op">&lt;-</span>   <span class="cn">FALSE</span>        <span class="co"># Drop the distance matrices</span></span>
<span><span class="va">threads</span>           <span class="op">&lt;-</span>   <span class="fl">1L</span>           <span class="co"># Number of threads to use</span></span>
<span></span>
<span><span class="va">knn_index_list</span>    <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/knn_index_mat.html">knn_index_mat</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">W</span>, <span class="va">k</span>,</span>
<span>                                     distance_metric <span class="op">=</span> <span class="va">distance_metric</span>,</span>
<span>                                     keep_dist       <span class="op">=</span> <span class="va">keep_dist</span>,</span>
<span>                                     threads         <span class="op">=</span> <span class="va">threads</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="searching-for-optimal-k">Searching for optimal K<a class="anchor" aria-label="anchor" href="#searching-for-optimal-k"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_step</span>   <span class="op">&lt;-</span>   <span class="fl">20</span>  <span class="co"># How many steps to take</span></span>
<span><span class="va">K_step</span>   <span class="op">&lt;-</span>   <span class="fl">5</span>   <span class="co"># Value between steps and starting value</span></span></code></pre></div>
<p>We first bootstrap the keys and then supply the bootstrapped keys to
the function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_search_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bootstrap_iterations</span>, <span class="kw">function</span><span class="op">(</span><span class="va">bootstrap_index</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">boot_key</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">key</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/knn_optimal_k.html">knn_optimal_k</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">W</span>, <span class="va">Y</span>, <span class="va">key</span>, <span class="va">N_step</span>, <span class="va">K_step</span>, <span class="va">knn_index_list</span>, </span>
<span>                  bootstrap_keys <span class="op">=</span> <span class="va">boot_key</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We then average across the RMSE values to find the optimal K value
across the bootstrap results.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rmse_avg_vec</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">boot_search_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">rmse_vec</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rmse_avg_vec</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">rmse_avg_vec</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;  KNN_100 </span></span>
<span><span class="co">#&gt; 214.5634</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">boot_search_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">k_vec</span>, <span class="va">rmse_avg_vec</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="st">"RMSE"</span>, xlab <span class="op">=</span> <span class="st">"K"</span><span class="op">)</span></span></code></pre></div>
<p><img src="causalKNN-Bootstrap_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>In this case, we see the bootstrapped optimal K search procedure
gives us an optimal K value of <span class="math inline">\(100\)</span>.
Note that this is the upper bound of our K grid. For production, we
should try the procedure with a larger K grid to ensure we have reached
the true optimal K value. For this vignette, we will use this K value of
<span class="math inline">\(100\)</span> for demonstrative purposes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bagged_optimal_K</span> <span class="op">&lt;-</span> <span class="fl">100L</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimating-cate">Estimating CATE<a class="anchor" aria-label="anchor" href="#estimating-cate"></a>
</h3>
<p>We can also use the bootstrap procedure to estimate the CATE in both
the direct causal KNN and the TEP procedures.</p>
<div class="section level4">
<h4 id="direct-causal-knn">Direct Causal KNN<a class="anchor" aria-label="anchor" href="#direct-causal-knn"></a>
</h4>
<p>We need to first compute the test set K nearest neighbor matrix.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knn_index_test_list</span>    <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/knn_index_mat.html">knn_index_mat</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">W</span>, <span class="va">k</span>,</span>
<span>                                          DF_test         <span class="op">=</span> <span class="va">X_test</span>,</span>
<span>                                          distance_metric <span class="op">=</span> <span class="va">distance_metric</span>,</span>
<span>                                          keep_dist       <span class="op">=</span> <span class="va">keep_dist</span>,</span>
<span>                                          threads         <span class="op">=</span> <span class="va">threads</span><span class="op">)</span></span></code></pre></div>
<p>Then, we can average across bootstrap iterations our direct Causal
KNN estimates.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_direct_list</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bootstrap_iterations</span>, <span class="kw">function</span><span class="op">(</span><span class="va">bootstrap_index</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">boot_key</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">key</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/causalknn_treatment_effect.html">causalknn_treatment_effect</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">Y</span>, <span class="va">key</span>, <span class="va">bagged_optimal_K</span>,</span>
<span>                               <span class="va">knn_index_test_list</span>,</span>
<span>                               key_test <span class="op">=</span> <span class="va">key_test</span>,</span>
<span>                               bootstrap_keys <span class="op">=</span> <span class="va">boot_key</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">direct_CATE_mat</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">boot_direct_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">treatment_effect</span><span class="op">)</span></span>
<span><span class="va">direct_CATE_DF</span>    <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>key    <span class="op">=</span>   <span class="va">boot_direct_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">key</span>,</span>
<span>                                  CATE   <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">direct_CATE_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="treatment-effect-projection">Treatment Effect Projection<a class="anchor" aria-label="anchor" href="#treatment-effect-projection"></a>
</h4>
<p>We will our bootstrap our TEP projection estimates and then project
using the Ridge for each bootstrap iteration. Then we average the
Ridge’s predicted values for our bootstrap averaged causal KNN TEP
estimates.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_TEP_list</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">bootstrap_iterations</span>, <span class="kw">function</span><span class="op">(</span><span class="va">bootstrap_index</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>    <span class="va">boot_key</span>        <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">key</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">causal_KNN_DF</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/causalknn_treatment_effect.html">causalknn_treatment_effect</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">Y</span>, <span class="va">key</span>, <span class="va">bagged_optimal_K</span>,</span>
<span>                                                    <span class="va">knn_index_list</span>,</span>
<span>                                                    bootstrap_keys <span class="op">=</span> <span class="va">boot_key</span><span class="op">)</span></span>
<span>    <span class="va">TEP_results_list</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/tep_enet.html">tep_enet</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">causal_KNN_DF</span><span class="op">$</span><span class="va">treatment_effect</span>, </span>
<span>                                     <span class="va">X_test</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>causal_KNN_DF <span class="op">=</span> <span class="va">causal_KNN_DF</span>, TEP_results_list <span class="op">=</span> <span class="va">TEP_results_list</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">TEP_CATE_mat</span>   <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">boot_TEP_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">TEP_results_list</span><span class="op">$</span><span class="va">test_TE</span><span class="op">)</span></span>
<span><span class="va">TEP_CATE_DF</span>    <span class="op">&lt;-</span>   <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>key    <span class="op">=</span>   <span class="va">key_test</span>,</span>
<span>                               CATE   <span class="op">=</span>   <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">TEP_CATE_mat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Walter Zhang, Guenter Hitsch, Sanjog Misra.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
